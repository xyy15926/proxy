---
title: *Vim* 编辑 - 寄存器、普通
categories:
  - Linux
  - Tool
  - Vi
tags:
  - Linux
  - Tool
  - Vi
  - Editing
date: 2021-12-02 10:32:29
updated: 2021-12-02 10:55:38
toc: true
mathjax: true
description: 
---

##	寄存器：删除、修改、复制

-	寄存器相关命令
	-	`:reg[isters] [ARGS]`/`:di[splay] [ARGS]`：显示 `ARGS` 寄存器内容
		-	`ARGS`：缺省所有寄存器

-	寄存器：存储文本、命令
	-	`"`：无名寄存器，删除、抽取命令文本存储于此，即使另外指定使用其他寄存器（除 `_` 外）
	-	`-`：行内删除寄存器，存储文本小于 1 行的修改、删除
	-	`0-9`：编号寄存器，可以手动更改
		-	`0`：最近抽取文本
		-	`1`：最近删除、修改文本（超过 1 行）
		-	`2-9`：依次存储较旧原 `1` 中文本
	-	`a-z`、`A-Z`：26 个具名寄存器，仅在指定时才使用
		-	小写字母：替换寄存器中内容
		-	大写字母：添加至寄存器中内容后
	-	`:`、`.`、`%`：只读寄存器
		-	`.`：最近插入文本
			-	类似 `CTRL-a`、`CTRL-@`
			-	不适用 `CTRL-r`，工作方式不同
		-	`:`：最近命令行
			-	要求命令行中包含至少一个键入字符，才会被记录
			-	`@:` 重复执行执行上次命令行命令
		-	`%`：当前文件名
	-	`#`：轮换缓冲区寄存器
		-	影响 `CTRL-^` 工作方式
	-	`=`：表达式寄存器，用于在使用寄存器的命令中使用表达式
		-	表达式结果必须是字符串，数值结果会自动转换为字符串
	-	`*`、`+`、`~`：选择、拖放寄存器，保存、取得 *GUI* 界面上选择的文本
		-	`*`：主选择
		-	`+`：剪切
		-	`~`：拖放
	-	`_`：黑洞寄存器，不存储在任何寄存器中，用于删除文本
	-	`/`：最近搜索模式寄存器
		-	可以用于 `n` 命令、`hlsearch` 选项，而无需经过搜索

##	删除、修改

###	删除文本

-	删除文本
	-	`["<REG>]d[MOTION]`：*操作符-动作* 删除，支持计数前缀
		-	常用同义单字符命令
			-	`dd`：删除当前行
			-	`x`/`<Del>`：`dl`
			-	`X`：`dh`
			-	`D`：`d$`
	-	`v_["<REG>]d`/`v_["<REG>]x`/`v_["<REG>]<Del>`：删除高亮文本至寄存器
	-	`v_["<REG>]D`/`v_["<REG>]X`：删除高亮行
	-	`:[RANGE]d[elete] [REG] [COUNT]`：从 `RANGE` 指定范围开始删除 `COUNT` 行至寄存器
		-	`:dl`/`:dell`/`:delel`/`:deletl`/`:deletel`：删除并列出
		-	`:dp`/`:delp`/`:delep`/`:deletp`/`:deletep`：删除并显示

-	删除并插入
	-	`["<REG>]c[MOTION]`：*操作符-动作* 修改（删除再插入），支持计数前缀
		-	常用同义单字符命令
			-	`cc`：删除当前行
			-	`s`：`cl`
			-	`S`：`cc`
			-	`C`：`d$`
	-	`v_["<REG>]c`/`v_["<REG>]s`：删除高亮文本至寄存器，并开始插入
	-	`v_["<REG>]C`/`v_["<REG>]S`/`v_["<REG>]R`：删除高亮行，并开始插入
	-	`:{RANGE}c[hange][!]`：替换 `RANGE` 指定的文本行，持续输入至仅包含 `.` 行
		-	`RANGE`：缺省当前行
		-	`!`：切换 `autoindent` 选项

-	通用参数列表
	-	`MOTION`：动作命令，操作符影响动作开始、结束位置间的整行、字符区
	-	`RANGE`：指定影响行区间
	-	`COUNT`：指定 `RANGE` 开始 `COUNT` 行作为影响区间
	-	`"<REG>`：内容存储到寄存器 `REG` 中，缺省 `"` 寄存器

###	简单修改

-	简单修改
	-	`r{CHAR}`：光标下字符替换为 `CHAR`，支持计数前缀
		-	`CHAR`：可为 `CTRL-e`、`CTRL-y`，表示使用下行、上行字符替代
		-	若 `CHAR` 为 `<CR>`、`<NL>`
			-	包含计数前缀也仅插入一个换行符
			-	会自动缩进
	-	`gr{CHAR}`：在屏幕位置上虚拟替换
	-	`v_r<CHAR>`：将高亮字符替换为 `CHAR`
	-	`r`、`gR`：进入替换、虚拟替换模式

-	大小写切换
	-	`g~<MOTION>`：*操作符-动作* 切换大小写
		-	`g~g~`/`g~~`：切换当前行大小写
		-	`v_g~`/`v_~`：切换高亮文本大小写
	-	`gU<MOTION>`：*操作符-动作* 切换大写
		-	`gUgU`/`gUU`：切换当前行为大写
		-	`v_gU`/`v_U`：切换高亮文本为大写
	-	`gu<MOTION>`：*操作符-动作* 切换小写
		-	`gugu`/`guu`：切换当前行为小写
		-	`v_gu`/`v_u`：切换高亮文本为小写
	-	`g?<MOTION>`：*操作符-动作* 切换 *ROT13* 加密
		-	`g?g?`/`g??`：切换当前行 *ROT13* 加密
		-	`v_g?`：切换高亮文本为 *ROT13* 加密
	-	`gc<MOTION>`：*操作符-动作* 切换注释、取消注释
		-	`gcgc`/`gcc`：切换当前行注释
		-	`v_gc`：选中区域按行注释/取消注释
	-	`~`：切换光标下字符大小写，并将光标右移（需复位 `tildeop` 选项）
		-	置位 `tildeop` 时，同 `g~`

-	数字增减
	-	`CTRL-a`：数值、字母加上 `COUNT`
		-	`v_CTRL-a`：高亮文本的数值、字母加上 `COUNT`
			-	仅修改首个数值
		-	`v_g CTRL-a`：若跨越多行，则按 `COUNT` 生成等差递增数列增加
		-	支持 10 进制、无符号 8 进制、无符号 16 进制、字母
	-	`CTRL-x`：数值、字母减去 `COUNT`
		-	v_CTRL-x`：高亮文本的数值、字母减去 `COUNT`
			-	仅修改首个数值
		-	`v_g CTRL-x`：若跨越多行，则按 `COUNT` 生成等差递增数列减去
		-	支持 10 进制、无符号 8 进制、无符号 16 进制、字母

-	相关选项
	-	`tildeop`：`~` 作为操作符
	-	`nrformats`：支持的数值进制列表
		-	`bin`：`0b`、`0B` 尝试视为 2 进制
		-	`octal`：`0` 尝试视为 8 进制
		-	`hex`：`0x`、`0X` 尝试视为 16 进制
		-	`alpha`：允许对字母增、减，方便构造字母列表

-	通用参数列表
	-	`MOTION`：动作命令，操作符影响动作开始、结束位置间的整行、字符区
	-	`"<REG>`：内容存储到寄存器 `REG` 中，缺省 `"` 寄存器

> - *ROT13* 即 13 移位加密，考虑到 26 个英文字母，则有两次回到原字符，即切换

###	文本移动

-	行连接
	-	`J`：连接 `COUNT` 行，至少包含两行，删除缩进，插入不多于两个空格
		-	`v_J`：连接高亮行，删除缩进，插入不多于两个空格
	-	`gJ`：连接 `COUNT` 行，至少包含两行，不插入、删除任何空格
		-	`v_gJ`：连接高亮行，不插入、删除任何空格
	-	`:[RANGE]j[oin]][!] [COUNT] [flags]`：连接 `RANGE` 开始的 `COUNT` 行
		-	`!`：连接不插入、删除任何空格

-	文本左、右移
	-	`<<MOTION>`：将行左移 `shiftwidth` 列
		-	`<<`：当前行左移，此计数前缀表示影响的行数
		-	`v_<`：高亮行左移 `COUNT` 次
	-	`><MOTION>`：将行右移 `shiftwidth` 列
		-	`>>`：当前行右移，此计数前缀表示影响的行数
		-	`v_<`：高亮行右移 `COUNT` 次
	-	`:[RANGE}< [COUNT] [FLAGS]`：指定多行左移 `<` 数量次数
	-	`:[RANGE]> [COUNT] [FLAGS]`：指定多行左移 `>` 数量次数
	-	`:[RANGE]le[ft] [INDENT]`：左对齐行，设置缩进距离为 `INDENT`
	-	`i_<c-d>`、`i_<c-i>`：减少、增加缩进

-	文本上下移动
	-	`:[RANGE]m[ove] [NUM]` ：移动范围内行至第 `NUM` 行
		-	`NUM`：取 `.` 表示下行
	-	`:[RANGE]co[py] [NUM]`：复制范围内行至第 `NUM` 行
	-	`:[RANGE]t [NUM]`：同 `:copy`

-	通用参数列表
	-	`MOTION`：动作命令，操作符影响动作开始、结束位置间的整行、字符区
	-	`RANGE`：指定影响行区间
	-	`COUNT`：指定 `RANGE` 开始 `COUNT` 行作为影响区间
	-	`FLAGS`：*ex-flags*，显示光标执行命令后所在行
		-	`l`：类似 `:list` 输出
		-	`#`：加上行号
		-	`p`：类似 `:print` 输出

-	相关选项
	-	`shiftwidth`：缩进宽度

###	文本过滤

-	过滤相关命令：将文本发送给过滤程序，用过滤程序的输出结果替换
	-	`!<MOTION><FILTER>`：*操作符-动作* 用外部程序 `FILTER` 过滤
		-	`!!<FILTER>`：外部程序 `FILTER` 过滤 `COUNT` 行
		-	`v_!<FILTER>`：外部程序 `FILTER` 过滤高亮行
	-	`:[RANGE]![!]<FILTER> [!] [ARG]`：外部程序 `FILTER` 过滤指定行
		-	`!`：使用上次使用的命令
	-	`=<MOTION>`：用 `equalprg` 选项指定外部程序过滤
		-	`==`：用 `equalprg` 过滤 `COUNT` 行
		-	`v_=`：用 `equalprg` 过滤高亮行

-	通用参数列表
	-	`MOTION`：动作命令，操作符影响动作开始、结束位置间的整行、字符区
	-	`RANGE`：指定影响行区间

-	相关选项
	-	`equalprg`：外部过滤选项，缺省为内部排版机制 *C-indenting*、*lisp*

> - 过滤程序接受文本作为标准输入，做出修改后放入标准输出
> - *Vim* 将过滤命令按 `shellredir` 选项重定向输出至在临时文件中

###	文本排版

-	排版相关命令
	-	`gq<MOTION>`：*操作符-动作* 排版
		-	依次考虑使用 `formatexpr` 选项、`formatprg` 选项、内部排版机制排版
		-	`gqgq`/`gqq`：排版 `COUNT` 行
		-	`v_gq`：排版高亮行
	-	`gw<MOTION>`：同 `gq`，但排版后光标恢复原位
	-	`:[RANGE]ce[nter] [WIDTH]`：居中对齐
		-	`WIDTH`：对齐宽度，缺省为 `textwidth`
	-	`:[RANGE]ri[ght] [WIDTH]`：靠右对齐
		-	`WIDTH`：对齐宽度，缺省为 `textwidth`
	-	`:[RANGE]le[ft] [INDENT]`：靠左对齐

-	通用参数列表
	-	`MOTION`：动作命令，操作符影响动作开始、结束位置间的整行、字符区
	-	`RANGE`：指定影响行区间

-	相关选项
	-	`formatexpr`：缓冲区排版函数
	-	`formatprg`：外部排版程序
	-	`formatoptions`：控制 *Vim* 排版

###	文本排序

-	文本排序
	-	`:[RANGE]sor[t][!] [ARGS] [/<PTN>/]`：对 `RANGE` 范围内行排序
		-	`!`：逆序
		-	`ARGS`：排序参数
			-	`i`：忽略大小写
			-	`l`：使用 *locale* 排序规则
			-	`n`、`f`、`x`、`o`、`b`：排序基于行内首个 10 进制、浮点、16 进制、8 进制、2 进制数
			-	`u`：只保留相同的的首行
			-	`r`：排序在 `PTN` 匹配的文本上进行，不匹配 `PTN` 的行保持原顺序
		-	`PTN`：排序在 `PTN` 之后的文本进行，为空则使用最近搜索模式

###	替换

-	替换相关命令
	-	`:[RANGE]s[ubstitute][/PTN][/TGT][/FLAGS] [COUNT]`：将指定范围内 `PTN` 替换为 `TGT`
		-	`:[RANGE]sno[magic]...`：同 `:substitute`，但总使用 `nomagic`
		-	`:[RANGE]sm[agic]...`：同 `:substitute`，但总使用 `magic`
	-	`:[RANGE]s[ubstitute] [FLAGS] [COUNT]`：使用使用上次 `:substitute` 相同 `PTN`、`TGT`
		-	`:[RANGE]&[&] [FLAGS] [COUNT]`：同 `:s`，但支持 `:&&` 表示使用相同 `FLAGS` 标志位
		-	`:[RANGE]~[&] [FLAGS] [COUNT]`：类似 `:&r`，使用最近搜索模式作为 `PTN`
	-	`&`：同 `:s`（不记住标志置位）
		-	`g&`：同 `:%s//~/&`（记住标志位）
	-	`:promptr[epl] [STRING]`：弹框搜索、替代，仅适用于 *GUI*

-	通用参数列表
	-	`TGT`：替换结果
		-	被省略时被假定为空，即删除，其后分隔符可省略
		-	以 `\=` 开始时，被作为表达式执行
		-	`\|` 分隔多个模式，字符的特殊含义如下

		|Magic|Nomagic|含义|
		|`~`|`\~`|前一个 `:substitute` 的 `TGT`|
		|`\~`|`~`|`~`|
		|`&`|`\&`|替代为完整匹配|
		|`\&`|`&`|`&`|
		|`\0`||完整匹配
		|`\1`-`\9`||匹配中第 1-9 个 `()` 中内容|
		|`\u`、`\U`、`\l`、`\L`||下个字符、之后字符成为大写、小写|
		|`\e`、`\E`||结束 `\U`、`\L`|
		|`<CR>`、`\r`||换行所需的字符（根据文件格式可能是 `<NL>`、`<CR>`、`<NL><CR>`）|
		|`\<CR>`||插入回车符 `<CR>`|
		|`\n`||插入换行符 `<NL>`（但在 *Vim* 中会被立刻替换为空白符 `<NUL>`）|
		|`\b`||插入 `<BS>`|
		|`\t`||插入 `<Tab>`|
		|`\\`||插入反斜杠|

	-	`RANGE`：指定影响行区间
	-	`COUNT`：指定 `RANGE` 开始 `COUNT` 行作为影响区间
	-	`FLAGS`：*s_flags* 指定替换行为，与 `:s`、`:&` 之间空格不必须（但 `:s` 与某些标志组合被其他命令占用）
		-	`&`：保留前次 `:substitute` 标志位，必须置首位
		-	`c`：确认每个替换
		-	`e`：搜索模式不成功，不给出错误信息，避免脚本中断
		-	`g`：替换行内所有匹配，缺省替换各行首个
		-	`i`、`I`：忽略、不忽略大小写
		-	`n`：输出匹配次数，但不替换
		-	`p`：显示包含最后一次替换的行
		-	`#`：同 `p`，前加上行号
		-	`l`：同 `p`，显示方式类似 `:list`
		-	`r`：使用最近搜索模式替代，仅适用于无参数的 `:&`、`:s`，否则仅考虑 `:substitute`、`:global`

-	其他说明
	-	搜索模式：`/`、`?`、`:s`、`:global` 命令中搜索关键字
	-	可用除字母、数字、`\`、`"`、`|` 外的任何单字节字符替代 `/` 作为分隔符

###	复制粘贴

-	复制、粘贴
	-	`["<REG>]y<MOTION>`：*操作符-动作* 抽出（复制）
		-	常用同义单字符命令
			-	`yy`/`Y`：复制 `COUNT` 行
		-	`v_["<REG>]Y`：复制高亮行
		-	`v_["<REG>]y`：复制高开文本
	-	`:[RANGE]y[ank] [REG] [COUNT]`：复制 `RANGE`、`COUNT` 指定行
	-	`["<REG>][g][]]p`：粘贴寄存器文本在光标后 `COUNT` 次
		-	`g`：光标留在新文本后
		-	`]`：调整行缩进
		-	`["<REG>][g][]]P`：粘贴文本在光标前 `COUNT` 次
	-	`["<REG>][]]<MiddelMouse>`：粘贴寄存器文本在光标后 `COUNT` 次
		-	`]`：调整行缩进
		-	光标留在新文本后
		-	要求 `mouse` 选项包含 `n`、`a`
	-	`:[LINE]pu[t][!] [REG]`：放置寄存器 `REG` 中文本至 `LINE` 行后
		-	`!`：放置在 `LINE` 行前
		-	`REG`：缺省由 `cb` 选项决定，`+`、`*`、无名寄存器

-	通用参数列表
	-	`MOTION`：动作命令，操作符影响动作开始、结束位置间的整行、字符区
	-	`RANGE`：指定影响行区间
	-	`COUNT`：指定 `RANGE` 开始 `COUNT` 行作为影响区间
	-	`"<REG>`：内容存储到寄存器 `REG` 中，缺省 `"` 寄存器

##	撤销、重做

-	所有对缓冲区的改变构成更改树
	-	树中每个叶节点（分支）对应一个撤销的终状态
	-	分支内可通过撤销命令回退，分支间只能跳转
	-	卸载缓冲区时会同时删除更改树

###	撤销、重做

-	撤销、重做
	-	`u`/`<Undo>`：撤销 `COUNT` 次更改
	-	`:u[ndo]`：撤销一次更改
	-	`CTRL-r`：重做 `COUNT` 次更改
	-	`:red[o]`：重做一次被撤销更改
	-	`U`：撤销对最近改变行的更改，包括 `U` 自身

-	撤销块
	-	`:undoj[oin]`：将其后的改变与之前的撤销块合并
		-	适合在函数中使用，将其改变合并
	-	`i_CTRL-g u`：拆分撤销块

-	撤销分支
	-	`:undol[ist]`：列出更改树的 **叶节点**
		-	`number`：标识叶节点
		-	`changes`：树根节点到此叶节点的改变数目
		-	`when`：改变发生时间
		-	`saved`：第几次写入文件
	-	`:u[ndo] <NUM>`：撤销至改变号 `NUM` 对应分支
	-	`g-`/`g+`：跳转到 `COUNT` 个前、后较早文本状态
	-	`:earlier <COUNT><UNIT>`、`:later <COUNT><UNIT>`：跳转到较早、较新文本状态
		-	`COUNT`：跳转间隔
		-	`UNIT`：跳转间隔单位
			-	`s`：`COUNT` 秒前、后
			-	`m`：`COUNT` 分钟前、后
			-	`h`：`COUNT` 小时前、后
			-	`d`：`COUNT` 天前、后
			-	`f`：`COUNT` 次写入前、后文本状态

-	相关选项
	-	`cpoptions`：兼容模式选项
		-	`u`：撤销命令撤销包含撤销命令在内的任何更改，重做命令可重复前一个撤销命令
	-	`undolevels`：可记录的最大改变次数
		-	`0`：运行于 *Vi* 兼容模式
		-	负值：不可撤销，可通过设置为负值、再修改强制清除撤销信息

-	说明
	-	撤销块：单个 `undo` 可以撤销的改变序列构成撤销块

###	撤销持久化

-	撤销持久化
	-	`wundo! [FILE]`：将撤销历史写入撤销文件
		-	`!`：强制写入，即使 `FILE` 不符合撤销文件（头部魔术数字）
	-	`rundo! [FILE]`：从撤销文件中读入

-	相关选项
	-	`undofile`：写入文件时自动保存撤销历史
		-	`undofile` 选项在写入文件后、`BufWritePost` 自动命令前，可通过 `BufWritePre` 命令控制选项
		-	每个文件（更改树）对应独立撤销文件，随文件一同加密
		-	*Vim* 会检查撤销文件是否和写入时文件内容一致，忽略不一致撤销文件
	-	`undodir`：存储撤销文件，缺省文件目录

##	重复

###	简单重复

-	简单重复
	-	`.`：重复上次改变 `COUNT` 次
		-	替换改变计数前缀，否则使用上次改变的计数前缀
		-	若上次改变使用数字编号寄存器，则逐次递增寄存器序号
	-	`@:`：重复上次命令行 `COUNT` 次
		-	需要编译时添加 `+cmdline_hist` 特性
	-	`:[ADDR]@:`：在 `ADDR` 行上重复上次命令行

-	行内查找重复
	-	`;`：重复最近 `f`、`t`、`F`、`T` 命令 `COUNT` 次
	-	`,`：反向重复最近 `f`、`t`、`F`、`T` 命令 `COUNT` 次

###	组合重复

-	多次重复
	-	`:[RANGE][v]g[lobal][!]/<PTN>/<CMD>/`：对 `RANG` 范围匹配 `PTN` 的文本执行 `CMD`
		-	`!`、`v`：对不匹配文本执行 `CMD`
		-	`RANGE`：指定影响行区间，缺省 `(1,$)` 整个缓冲区
		-	`CMD`：可使用 `:normal` 命令执行非 *Ex* 命令
		-	可用除字母、数字、`\`、`"`、`|` 外的任何单字节字符替代 `/` 作为分隔符

-	重复组合（宏记录）
	-	`q<REG>`：在寄存器 `REG` 中记录键入字符
		-	`q`：停止记录，不会保留在寄存器中
		-	`REG`：不包括 `%`、`#` 寄存器
	-	`@<REG>`：执行寄存器 `REG` 中内容 `COUNT` 次
		-	`@@`：执行上次执行的寄存器 `COUNT` 次
	-	`:[ADDR]*<REG>`/`:[ADDR]@<REG>`：将寄存器 `REG` 内容作为 *Ex* 命令在 `ADDR` 行执行
		-	`:[ADDR]@[@]`：在 `ADDR` 行上重复上次执行 `REG`

###	执行脚本

-	脚本执行
	-	`:so[urce] <FILE>`：读取（执行）*Ex* 命令，激活 `SourcePre` 命令
	-	`:so[urce][!] <FILE>`：读取（执行）*Vim* 命令（即 *normal* 模式下命令）
	-	`:ru[ntime][!] [WHERE] <FILE>`：从 `runtimepath`、`packpath` 指定目录查找 `FILE`，读取、执行其中 *Ex* 命令
		-	`!`：执行所有找到文件，否则只执行首个
		-	`WHERE`：缺省只使用 `runtimepath`
			-	`START`：`packpath` 中 `start` 目录
			-	`OPT`：`packpath` 中 `opt` 目录
			-	`PACK`：`packpath` 中 `start`、`opt` 目录
			-	`ALL`：先 `runtimepath`，后 `packpath` 中 `start`、`opt`
		-	无匹配文件不报错
	-	`:pa[ckadd][!] <NAME>`：在 `packpath` 中搜索可选的插件目录，然后加载插件
		-	说明
			-	缺省在 `<runtimepath>/pack/*/opt` 中搜索
			-	若 *Vim* 启动时跳过 `<runtimepath>/pack/*/start`，则同样搜索其中

