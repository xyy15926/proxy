---
title: *Vim* 编辑 - Motion、可视
categories:
  - Linux
  - Tool
  - Vi
tags:
  - Linux
  - Tool
  - Vi
  - Editor
date: 2021-11-04 10:29:09
updated: 2021-12-01 11:02:15
toc: true
mathjax: true
description: 
---

##	动作

> - 大部分动作命令均可支持计数前缀指定动作次数

###	*操作符-动作*

-	*操作符-动作*：操作符后跟动作命令，操作符被作用于所跨越文本上
	-	操作符影响开始、结束位置间的整行、字符区
		-	行间移动的动作影响整行（面向行）：总包含开始、结尾
		-	行内移动的动作影响字符区间（面向字符）
			-	闭动作：开始、结束位置在操作范围内
			-	开动作：开始、结束位置在操作范围外
		-	动作行为可以通过在操作符后使用 `v`、`V`、`CTRL-v` 转换类型
			-	`v`：强制面向字符
			-	`V`：强制面向行
			-	`CTRL-V`：强制面向区块
	-	*操作符-动作* 中二者前均可使用计数前缀，效果相同
	-	除 *操作符-动作* 外，还可通过
		-	后跟文本对象，表示操作范围
		-	在可视模式对选中区域进行操作
		-	后接 `:` 开启 *Ex* 命令，定义动作（命令超过一行时，操作不能用 `.` 重复）

-	操作符：一般用于删除、改变文本（的命令）
	-	`c`：*Change*，修改
	-	`d`：*Delete*，删除
	-	`y`：*Yank*，抽出到寄存器
	-	`~`：变换大小写（`tildeop` 置位时生效）
	-	`g~`、`gu`、`gU`：变换、变小、变大写
	-	`!`：通过外部程序过滤
	-	`=`：通过 `equalprg` 过滤
		-	缺省为 *C-indenting* 过滤
	-	`gq`、`gw`：文本排版，移动、不移动光标
	-	`>`、`<`：右移、左移
	-	`zf`：定义折叠
	-	`g@`：调用 `operatorfunc` 指定的函数

###	上下左右

-	相关选项
	-	`virtualedit`：设置光标对空白处的移动逻辑
	-	`startofline`：置位后，*jump-motion* 跳转至行首首个非空白字符

####	左右动作

-	左右动作
	-	`h`/`<Left>`/`CTRL-h`/`<BS>`：向左，开
	-	`l`/`<Right>`/`<Space>`：向右，开
	-	`0`/`<Home>`：行首个字符，开
	-	`^`：行首首个非空白字符，开
	-	`$`/`<End>`：行尾，闭
	-	`g_`：行尾末个非空白字符，闭
	-	`g0`/`g<Home>`：屏幕行首（行回绕、行显示不全时，屏幕行不等同于文本行）
	-	`g^`/`g<Home>`：屏幕行首非空白
	-	`gm`：屏幕行中间
	-	`[PERCENT]gM`：在文本行内移动
		-	`PERCENT`：移至文本行 `PERCENT` 处
	-	`g$`、`g<End>`：屏幕行尾，闭
	-	`[COUNT]|`：到当前行 `COUNT` 列
	-	`f<CHAR>`、`F<CHAR>`：上个、下个字符 `CHAR` 处，闭
	-	`t<CHAR>`、`t<CHAR>`：下个字符 `CHAR` 前、上个字符 `CHAR` 后，闭
	-	`;`：重复上次 `f`、`F`、`t`、`T`
	-	`,`：反方向重复上次 `f`、`F`、`t`、`T`

####	上下动作（行动作）

-	上下动作（均为行动作）
	-	`k`/`<Up>`/`CTRL-p`：向上
	-	`j`/`<Down>`/`CTRL-j`/`<NL>`/`CTRL-n`：向上
	-	`gk`/`g<Up>`：屏幕行向上
	-	`gj`/`g<Down>`：屏幕行向下
	-	`-`：向上，停在行首首个非空白（缺省上一行）
	-	`+`/`CTRL-m`/`<CR>`：向上，停在行首首个非空白
	-	`_`：向下，停在行首首个非空白（缺省当前）
	-	`[NUM]G`：第 `NUM` 行，缺省尾行，*jump-motion*
	-	`[NUM]gg`/`[NUM]<C-End>`：第 `NUM` 行，*jump-motion*
	-	`:[RANGE]`：`RANGE` 末行
	-	`:[COUNT]%`：文件百分之 `COUNT` 处行首首个非空白字符，*jump-motion*
	-	`:[RANGE]go[to] [COUNT]`：第 `COUNT` 字节，缺省 1（缓冲区开头）

####	相对窗口动作

-	相对窗口动作
	-	`H`、`M`、`L`：窗口顶、中间、底处行首非空白字符，行
		-	窗口顶、底取决于 `scrolloff` 选项设置
	-	`<LeftMouse>`：鼠标点击位置，开

###	单词动作

-	单词动作
	-	`<S-Right>`/`w`、`<S-Left>`/`b`：正向、反向单词首，开
	-	`<C-Right>`/`W`、`<C-Left>`/`B`：正向、反向字串首，开
	-	`e`、`ge`：正向、反向单词尾，闭
	-	`E`、`gE`: 正向、反向字串尾，闭

-	文本对象动作
	-	`)`、`(`：正向、反向句子，开
	-	`}`、`{`：正向、反向段落，开
	-	`]]`：正向小节、或出现在首列的 `{`，开
	-	`][`：正向小节、或出现在首列的 `}`，开
	-	`[[`：反向小节、或出现在首列的 `{`，开
	-	`[]`：正向小节、或出现在首列的 `}`，开

-	说明
	-	已折叠行序列被作为单个字符组成的单词
	-	文本元素
		-	字串又非空白字符序列组成，空白分隔
		-	句子以 `.`、`!`、`?` 结尾，并紧跟换行符、空格、制表符
		-	段落以空行、段落宏命令开始
		-	小节以每个首列出现换页符 `<C-l>`、小节宏命令开始

-	相关选项
	-	`iskeyword`：指定单词组成部分（决定分词）
	-	`paragraphs`：定义段落宏的成对字串
	-	`sections`：定义小节宏的成对字串
	-	`quoteescape`：跳过转义符号

####	文本对象选择


-	文本对象选择：只能在可视模式、操作符之后使用的命令
	-	文本对象选择中
		-	`a`：选择包含空白的整个对象
		-	`i`：选择内含对象（不包含空白)，空白本身也是内含对象

-	文本对象选择命令
	-	`aw`、`iw`：完整、内含单词，包括开头、拖尾空白
	-	`aW`、`iW`：完整、内含字串
	-	`as`、`is`：完整、内含句子
	-	`ap`、`ip`：完整、内含段落
	-	`a]`/`a[`、`i]`/`i[`：`[]` 块，包括、不包括端点 `[]`
	-	`a)`/`a(`/`ab`、`i)`/`i(`/`ib`：`()` 块，包括、不包括端点 `()`
	-	`a>`/`a<`、`i>`/`i<`：`<>` 块，包括、不包括端点 `<>`
	-	`a}`/`a{`/`aB`、`i}`/`i{`/`iB`：`{}` 块，包括、不包括端点 `{}`
	-	`at`、`it`：标签块，包括、不包括标签
		-	只查找成对的 `<XXXX></XXXX>` 标签，自成对、无匹配标签被忽略
	-	`a"`、`a'`、<code>a\`<\code>：引号字符串，包括引号
		-	只在同一行内有效
		-	不支持计数前缀
	-	`i"`、`i'`、<code>i\`</code>：引号字符串，不包括引号

####	语言相关匹配动作

-	相关命令
	-	`%`：找到本行的光标后的下个项目，并跳转到其匹配
		-	支持项目包括
			-	`()`、`[]`、`{}`：可用 `matchpairs` 选项改变
			-	`/*...*/`：C 风格注释的开头、结尾
			-	`#if`、`#ifdef`、`#else`、`#elif`、`#endif`：C 预处理条件宏
		-	可用 `matchit` 插件匹配其他项目
	-	`])`、`[(`：正向未匹配的 `)`、反向未匹配的 `(`
	-	`]}`、`[{`：正向未匹配的 `{`、反向未匹配的 `}`
	-	`]m`、`[m`、`]M`、`[M`：正向、反向方法的开始、结尾处
		-	适用于 Java 或类似结构的语言
	-	`]#`、`[#`：正向、反向未匹配的 `#if`、`#else`
		-	适合用于寻找 C 中 `#if`、`#else` 结构，并结合 `%` 跳转
	-	`]*`/`]/`、`[*`/`[/`：正向、反向 C 注释开始 `/*`、结束 `*/`

-	相关选项
	-	`matchpairs`：定义符号对

###	位置记录

-	位置标记跳转命令
	-	<code>\`<MARK></code>：跳转至位置标记 `MARK` 处，开
	-	`'<MARK>`：跳转至位置标记 `MARK` 处行首首个非空白字符，行
	-	`g'<MARK>`、<code>g\`<MARK></code>：跳转至位置标记 `MARK` 处，不更改跳转表
	-	`:marks [MAKRS]`：列出位置标记
		-	`MARKS`：位置标记列表（空白或无分隔），缺省除 `(`、`)`、`{`、`}` 外所有
	-	`:delm[arks][!] [MARKS]`：删除位置标记（不能删除 `'`）
		-	`!`：删除当前缓冲区所有位置标记
	-	`]'`、<code>]\`</code>：正向下个包含小写位置标记
	-	`['`、<code>[\`</code>：反向下个包含小写位置标记

-	位置标记设置命令
	-	`m<CHAR>`：记录当前位置于位置标记 `CHAR` 中（标记不可见）
	-	`:[RANGE]ma[rk] {a-zA-Z'}`：设置位置标记于 `RANGE` 末行 0 列
		-	`RANGE`：缺省当前行
	-	`:[RANGE]k{a-zA-Z'}`：同 `:mark`
	-	`:loc[kmarks ] <CMD>`：执行 `CMD`，并且不调整位置标记
		-	可用于不影响行数的文本改动，否则标记保持行数不变偏离原位置
	-	`:kee[pmarks] <CMD>`：保持过滤 `:!` 结果中位置标记
		-	若过滤后行数不少于过滤前，过滤行中标记保持不变
		-	若过滤后行数减少，消失行中的标记被删除

-	位置标记：除 `a-zA-Z` 外都由 *Vim* 自动设置
	-	`{a-z}`：文件内位置
		-	单个文件内有效，缓冲区卸载时丢失
	-	`{A-Z}`：文件位置
		-	整个会话（文件间）公用，即会跳转至其他文件
		-	可存储在 *viminfo* 中
	-	`{0-9}`：依次距今更远的、离开 *Vim* 时的位置
		-	可存储在 *viminfo* 中
	-	`^`：前次插入位置（即退出插入模式位置）光标位置
	-	`.`：上次编辑位置
	-	`'`、<code>\`</code>：前个跳转位置
		-	<code>\`\`</code>/`''`：回到上个跳转位置，可以循环跳转
	-	`"`：上次离开缓冲区的位置
	-	`[`、`]`：上次影响（改变、抽出）文本区域开始、结束位置
		-	删除文本后，开始、结束位置重合（除非列块模式）
	-	`<`、`>`：上次可视模式选择区域的开始、结束位置
	-	`(`、`)`：句子开始、结尾
	-	`{`、`}`：段落开始、结尾

###	跳转表

-	改变表、跳转表
	-	跳转表：记录跳转（光标移至数行外）位置
		-	每个窗口有独立跳转表，最多存储 100 项
		-	跳转表包含窗口中不同缓冲区的跳转位置
		-	跳转表会复制到被分隔的窗口中
		-	同一行的新跳转会删除旧的跳转
	-	改变表：记录文本改变的位置的表
		-	同一行内、列差小于 `textwidth` 的两个可撤销的改变中，仅有较新者被记录

-	跳转表相关命令
	-	`[COUNT]CTRL-o`、`[COUNT]CTRL-i`/`[COUNT]<Tab>`：跳转到跳转表中 `COUNT` 个较新、较老跳转处
		-	可以跨文件跳转
	-	`:ju[mps]`：输出当前窗口跳转表
		-	`>` 指示当前在跳转表中所在位置
		-	序号指示需要 `CTRL-o`、`CTRL-i` 的次数
	-	`:cle[arjumps]`：清除当前窗口跳转表
	-	`:keepj[umps] <CMD>`：执行 `CMD`，其中跳转不改变 `'`、`.`、`^` 位置标记、跳转表、改变表

-	改变表跳转
	-	`[COUNT]g;`、`[COUNT]g,`：转到改变表中第 `COUNT` 个较新、较久的位置
		-	若 `COUNT` 超过范围，跳转到边界处
	-	`:changes`：输出当前窗口改变表
		-	`>` 指示当前在跳转表中所在位置

> - 跳转：将光标移至行外的命令导致的光标移动，不包括行内查找、`j`、`k`
> - 需编辑时加入 `+jumplist` 特性

##	*Visual*

-	可视模式的流程
	-	`v`、`V`、`CTRL-v` 进入 *Visual* 模式，标记文本开始
	-	移动光标至目标位置，开始、目标位置间文本高亮显示
	-	键入命令，应用于高亮文本

-	可视模式适用
	-	支持类似 *操作符-动作* 的模式
		-	可与操作符命令连用
		-	支持文本对象选择、单词匹配选择范围
	-	支持前缀计数、寄存器存储数据
	-	重复可视模式操作时，操作被应用到从光标开始、与上次操作相同数量的文本上
		-	行可视：相同数量行
		-	列块可视：相同数量行、列
		-	行内可视：相同数量字符
		-	跨行可视：相同数量行，最后行字符于上次相同、或 `$` 到末尾

###	进入可视模式

-	进入可视模式相关命令
	-	`[COUNT]v`：字符可视模式
		-	`COUNT`：`COUNT` 倍选择上次可视模式中使用的字符数、行数、块高宽，缺省只选择光标下字符
	-	`[COUNT]V`：行可视模式
		-	`COUNT`：`COUNT` 倍选择上次可视模式中使用的行数，缺省只选择光标下行
	-	`[COUNT]CTRL-v`：块可视模式
		-	`COUNT`：`COUNT` 倍选择上次可视模式中使用的字符数、行数、块高宽，缺省只选择光标下字符
	-	`v_<Esc>`/`v_CTRL-c`：停止可视模式

-	说明
	-	不同可视（子）模式下，可以直接相互切换
	-	可视（子）模式下，可通过进入可视（子）模式命令退出

###	可视模式操作

-	可视模式命令：适用于 *操作符-动作*
	-	`gv`：进入可视模式，选择范围、模式同上次
		-	`v_gv`：交换当前和上次选择区域
	-	`gn`：使用前次搜索模式正向匹配，并启动可视模式选中匹配
		-	总是正向匹配，即使前次搜索模式为逆向
		-	`v_gn`：扩展至下个匹配，中途未匹配部分也被选中
	-	`gN`：同 `gn`，但反向匹配
	-	`v_o`：光标移动到被选择文字另一端
		-	列块选择模式下移动到对角
	-	`v_O`：光标移动到被选择文字另一端
		-	列块选择模式下移动到同侧角

-	列块可视模式操作
	-	`v_I`：列块插入，从选择区域开始处，在每行插入
	-	`v_A`：列块添加，从选择区域结束处，在每行插入
		-	若列块通过 `v_$` 产生，字符串附加到每行末尾
		-	否则，字符串添加到每行列块末尾，中间用空格填充
	-	`v_c`：选择区域所有文本用相同字符串替代
	-	`v_C`：同 `v_c`，但选择区域扩展至每行
	-	`v_>`：列块按 `shiftwidth` 指定单位移动
		-	按 `tabstop`、`expandtab` 选项决定填充方式
	-	`v_r`：列块被同一字符替代
		-	制表符、虚拟空白符等将被替换保持屏幕布局
	-	`v_$`：高亮文本右边界取决于高亮区域最长行

-	说明
	-	不能使用 *Ex* 命令、可能改变（放弃）文件的命令，修改可视区域范围
	-	不同窗口的同一缓冲区光标位置会被调整以使相同区域被选中，这方便在不同窗口查看起、终点

-	相关选项
	-	`selection`：光标选择范围
		-	`inclusive`：包含光标下字符
		-	`exclusive`：不包含光标下字符
	-	`virtualedit`：光标可以移至任意位置

##	查找、替换

-	相关命令
	-	`[:]/<TGT>[/MODE]`、`[:]?/<TGT>[/MODE]`：前向、逆向查找
		-	*Normal* 模式下 `/`、`?` 可以直接进入命令行查找
		-	`MODE`：指定查找模式
			-	`c`：强制大小写不敏感
			-	`C`：强制大小写敏感
		-	`TGT`：查找目标
			-	可包特殊记号：`\>` 匹配单位结尾、`\<` 匹配单词开头
	-	`:[RANGE]g[lobal][!]/<PNT>/[CMD]`：对包含 `PTN` 的配行执行 `CMD`
		-	`[!]`：对不匹配者执行操作
		-	`RANGE`：查找范围范围
			-	全文替换`%`：`:%s/foo/bar`
			-	第一行`^`：`:^,4s/foo/bar`
			-	当前行`.`：`:.,6s/foo/bar`
			-	末尾行`$`：`:4,$s/foo/bar`
			-	可视模式下，选择区域后命令行自动补全为 `:'<,'>`
		-	`CMD`：待执行操作，缺省为 `:print` 命令
		-	若标记行在被操作之前已经被删除、移动、合并等而消失，则不对其执行操作
	-	`:[RANGE]s/<PTN>/<TGT>[/MODE]`：将 `PTN` 替换为 `TGT`
		-	`RANGE`：替换范围，缺省当前行
		-	`PTN`：待替换值（可用查找模式的标志字符指定被替换项，反斜杠 `\` 分隔）
		-	`MODE`：替换模式
			-	`I`：大小写敏感
			-	`i`：大小写不敏感
			-	`g`：全局替换（替换每行全部模式，否则只替换首个）
			-	`c`：交互替换，每次替换询问
		-	`TGT`：替换目标
			-	其中可包含超级变量 `&`，代表被替换模式字串

-	相关快捷键
	-	`n`、`N`：同向、反向重复上次查找
	-	`*`、`#`：前向、逆向查找当前单词
	-	`g*`、`g#`：前向、逆向查找当前字符串，包括非单独单词

-	相关选项
	-	`ingorecase`：大小写不敏感查找
	-	`smartcase`：查找项中有大写字符则敏感

```c
:g/^/m 0
	# 将文件反序
:g/^/+1 d
:%normal jdd
	# 删除偶数行
:g/^/d|m.
:%normal jkdd
	# 删除奇数行
:g!/aaa/d
	# 删除不包含`aaa`行
:g/aaa/"ay
	# 复制包含`aaa`行至寄存器`"`
```

###	跨文件查找

-	相关命令
	-	`:vim[grep] /<PTN>/[MODE] <FILE>`：在工作目录下所有文件中查找
		-	`MODE`：指定查找模式
			-	`g`：全局匹配（匹配每行全部）
			-	`j`：查找完毕后，进更新quickfix列表，光标不跳转
		-	`FILE`：查找范围
			-	`%`：当前文件
			-	`*`：当前目录
			-	`**/*`：仅子目录
			-	`**/xxxx`：当前目录及子目录所有满足`xxxx`模式文件
			-	`pattern`：满足`pattern`的文件

