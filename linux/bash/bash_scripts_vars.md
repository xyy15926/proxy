---
title: Bash 参数、变量、数组
categories:
  - Linux
  - Bash Programming
tags:
  - Linux
  - Bash
  - Shell
  - Grammer
date: 2019-08-01 02:23:16
updated: 2021-08-25 23:08:00
toc: true
mathjax: true
comments: true
description: Shell编程基础
---

##	*Parameter*、*Variable*

-	*Parameter* 参数：存储值的实体，可以是名称、数字、特殊字符
	-	参数被赋值之后即被设置，只能通过 `unset` 移除

-	*Variable* 变量：名称表示的参数
	-	可通过 `declare` 命令设置零个或多个属性

###	变量

-	变量名规则
	-	字母、数字、下划线组成
	-	首字符必为字母、下划线
	-	不能为 Shell 中的关键字

-	变量值读取：`$<var-name>` / `${<var-name>}`
	-	Shell `-u` 参数未设置时
		-	若变量名未声明，则返回空字符串
		-	或者说 Bash 中不存在的值默认为空字符串
	-	其他参数值读取参考 *Shell 扩展*

-	变量删除：`$ unset <var-name>`
	-	仅考虑值方面，等同于将变量设置为字符串 `$ <var-name>=`（Shell `-u` 标志未设置）
	-	不能删除只读变量

###	`\`、`'`、`"`

-	`\`：转义字符
	-	放在命令同名别名前，取消 `alias`
	-	特殊符号前转义，作为普通字符输出：`$`、`\`、`*`、`!`
	-	不可打印字符的转义
		-	需使用 `echo -e` 参数、转义字符在引号内
	-	位于行尾表示连接下一行，
		-	也可以将 `\n` 视为命令结束，`\` 将 `\n` 转义普通空白符

-	`'`：将包含特殊字符的字符串作为扩起为整体
	-	保留字符的字面含义，特殊含义字符在其中视为普通字符
		-	`'` 扩起的内部无法通过 `\'` 转义输出 `'`
	-	可在字符串前加 `$` 激活 `\` 转义
		-	向字符串中添加转义序列表示的不可打印字符
		-	允许通过 `\'` 插入 `'`

-	`"`：将包含特殊字符的字符串作为扩起为整体
	-	其中大部分特殊字符变成普通字符，但如下字符
		-	`$`：引用变量
		-	<code>`</code>：执行子命令
		-	`\`：转义
	-	常用于压制分词
		-	扩起包含空格文件名
		-	保持命令输出格式：`$ echo "$(cal)"`
	-	大部分情况下 `"` 扩起字符串不影响其含义，但
		-	包含 `$IFS` 的字符串字面值被扩起时视为整体，无法被 `for` 迭代

###	变量赋值

-	`<name>=<val>`：参数赋值
	-	Bash 所有值都是默认是字符串，没有数据类型概念
		-	`val` 可以是空（字符串）
		-	相邻（无空白）字符串（变量值）自动拼接
	-	`val` 会被应用如下 Shell 扩展
		-	*Tilde* 扩展
		-	参数、变量扩展
		-	命令替换
		-	算术扩展
		-	标记移除
	-	分词、花括号扩展、文件名扩展不对赋值语句应用
	-	若参数有 `integer` 属性，则 `val` 被按照算术表达式计算
	-	注意事项
		-	定义时不加`$`符号
		-	等号前后不能有空格
		-	已声明变量可以重新赋值
		-	值中若包含空格需要用引号扩起，否则被视为设置环境变量、再执行命令
		-	可用 `;` 分隔同一行中的多个变量声明（即多条命令）

-	`<name>+=<val>`：自增运算赋值
	-	`name` 有 `integer` 属性时，按照算术表达式计算
	-	`name` 为字符串时，字符串扩展
	-	`name` 为数组、`val` 为数组 *compound* 赋值形式 `(...)` 时，数组扩展

-	赋值语句也作为部分命令的参数
	-	`alias`
	-	`declare`
	-	`typeset`
	-	`export`
	-	`readonly`
	-	`local`

-	赋值语句可以用于设置命令执行环境，不影响当前 Shell 环境
	-	这使得赋值语句可用空格分隔

###	`declare`

`declare`：声明特殊类型的变量

-	变量声明参数

	-	`-i`：声明变量为整形，给变量赋值时将执行算术运（无需 `$(()))`）
		-	可直接用于数学运算、存储运算结果
		-	被声明为整数后仍然可被赋非整形值不报错，但其结果为不可预期的整型值
	-	`-a`：声明变量为普通数组
	-	`-A`：声明变量为关联数组（下标支持字符串，类似字典）
	-	`-u`：声明变量值为大写字母
		-	自动将变量值转换为大写字母
	-	`-l`：声明变量值为小写字母
	-	`-r`：声明变量只读
		-	无法改变变量值，对齐赋值将报错
		-	只读变量无法 `unset` 移除
	-	`-x`：设置为变量为环境变量
		-	同 `export`
	-	`+`：和以上联合使用，取消定义的变量类型
	-	`-g`：在函数中创建全局变量
	-	`-n`：设置变量为 `nameref`，其他参数的引用
		-	对 `nameref` 变量的属性修改、引用、赋值、移除，都作用于其引用的参数
		-	通常用于
			-	函数内部引用其参数，并修改
			-	`for` 循环中允许被迭代对象为变量列表（无需间接扩展）

-	列出变量、函数参数
	-	`-f`：列出脚本中定义的函数名称、函数体
	-	`-F`：列出脚本中定义的函数名称
	-	`-p`：查看变量信息

###	`local`

`local`：在函数中定义局部变量，覆盖全局变量

-	说明
	-	Shell 中变量作用域缺省为全局，`local` 将其限制在函数、子函数
		-	被覆盖的全局变量不会在函数内修改
		-	可以修改参数 `-`，仅在函数内部生效
	-	函数中，在其他 Shell 启动的程序不能访问局部变量
	-	退出值为 0，除非 `local` 被用在函数外

-	参数同 `declare`

###	`readonly`

`readonly`：声明只读变量

-	说明
	-	不能对只读变量再赋值、移除
	-	退出值为 0，除非提供错误参数

-	参数
	-	缺省：打印所有只读变量
	-	`-f`：声明变量为函数
	-	`-p`：打印所有只读变量
	-	`-a`：声明变量为只读数组
	-	`-A`：声明变量为关联数组（下标支持字符串，类似字典）

###	`unset`

`unset`：移除变量、函数

-	说明
	-	可移除数组某个成员
	-	无法移除只读变量
	-	退出值为 0，除非尝试移除只读变量

-	参数
	-	缺省：先尝试移除同名变量，无同名变量则尝试移除同名函数
	-	`-v`：移除所有 Shell 变量
	-	`-f`：移除函数
	-	`-n`：仅移除 `nameref` 变量，而不是其引用对象

###	特殊参数

> - <https://runebook.dev/en/docs/bash/special-parameters>

-	位置参数：由数字（除 `0` 外）代表的参数
	-	向脚本、函数传递的位置参数
		-	函数内部，传递给函数的参数将覆盖脚本参数
	-	位置参数获取
		-	`$1,...,$9`：单个数字表示的位置参数
		-	`${<NUM>}`：两位及以上数字的位置参数可以用
	-	可用 `set`、`shift` 命令设置、取消
		-	`set -- <pos-param>`：设置位置参数
		-	`shift <n>`：剔除前 `n` 个位置参数

-	参数相关特殊参数：不可被再次赋值
	-	`$0`：shell执行脚本名
		-	交互式bash（即普通终端中）该参数为`-bash`
			-	则`source`执行脚本时，该参数可能非预期
		-	以下shell变量均不考虑`$0`，如
			-	函数中`$0`也是脚本名
			-	`shift`无法跳过该参数
	-	`$#`：脚本、函数参数数量
	-	`$@`：脚本、函数参数列表
		-	总是执行分词，被 `"` 括起时扩展为分词结果被括起
	-	`$*`：脚本、函数参数列表
		-	被 `"` 括起时不分词，返回单个字符串，各参数值使用 `IFS` 值的首个字符分隔
	-	`$_`：上条命令的最后一个参数

-	其他特殊参数：不可被再次赋值
	-	`$$`：当前进程的 PID
	-	`$!`：最近一个后台执行的异步命令的 PID
	-	`$?`：上条命令执行结果
	-	`$-`：当前 Shell 的启动选项（即 `set` 标志）

##	算数运算

###	算术运算表达式

> - <https://runebook.dev/en/docs/bash/shell-arithmetic>

-	支持算术运算符：支持 `<ops>=` 自运算赋值
	-	双目：`+`、`-`、`*`、`/`、`%`、`**`
	-	单目：`++`、`--`
-	其他进制转换为 10 进制
	-	任意进制 `sys`：`<sys>#<value>`
	-	16 进制：`0x<hex>`
	-	8 进制：`0<oct>`
-	位运算：支持 `<ops>=` 自运算赋值
	-	移位：`<<`、`>>`
	-	按位：`&`、`|`、`~`、`^`
-	逻辑运算
	-	数值比较：`<`、`>`、`<=`、`>=`、`==`、`!=`
	-	逻辑与或：`&&`、`||`、`!`
	-	三目运算：`<cond>?<true-branch>:<false-branch>`

###	`((...))`、`let`

-	`let`、`((...))`：计算整数算术表达式值（结果总是整数），支持赋值
	-	退出值
		-	赋值表达式退出值总为 0
		-	表达式结果为 0 则退出值 1，命令执行不成功
		-	表达式结果非 0 则退出值 0，命令执行成功
	-	参数说明
		-	可用 `()` 改变运算顺序
		-	其中变量名 `$` 可省略
		-	非有效整数变量（空、未声明、非整数值、引号扩起的字符串）被视为 0 参与运算，不报错
		-	可用 `,` 分隔多个表达式，退出值由最后表达式决定

	```sh
	$ let foo=1+2; ((foo = 1+2))
	$ let b=16#4F; ((b=15#4F))
	$ let c=a++; ((c=a++))
	$ let d=c+1, foo*3; ((d=c+1, foo*3))
	```

####	`let`

-	`let` 特点
	-	参数表达式如果包含空格、逻辑运算符等，需要用 `"` 扩起
	-	除 `,` 外，也可以用空格分隔多个赋值表达式

	```sh
	let "a=3+4" "b = 4*5"
	```

####	`((...))`

-	`((...))` 特点
	-	可用 `$` 得到算术扩展语法，扩展为运算结果
		-	多个表达式返回最后表达式值
	-	自动忽略其中空格

	```sh
	echo $((a=4*5, b=6+7))
	```

> - `[]` 支持算术运算，但退出状态和 `(())` 相反，不建议使用

###	`/usr/bin/expr`

-	`expr`：对参数执行算术运算并 **输出至标准输出**
	-	参数说明
		-	无效整形参数参与运算将报错，变量需要 `$` 获取其值
		-	运算值、运算符之间用空格分隔

	```sh
	$ expr 3 + 2
	```

##	数组

> - 列表：分词结果、空格分隔的字符串
> - 数组的其他一些操作参考 *bash_expansion*

###	创建数组、关联数组

-	一次性赋值：`<arr>=(<expr>)`
	-	`expr` 为列表：各值按照顺序作为数组元素
	-	`<arr>=([idx]=<val> ...)`：按照指定序号创建元素
		-	可仅为部分元素指定下标，未指定序号元素自增
		-	未指定元素序号置空

	```sh
	$ arr=(*sh {a,b,c}.sh)
	$ weeks=([2]=Tue Wed)
	```

-	逐个赋值：`<arr>[<idx>]=<val>`

-	关联数组：允许使用一般字符串作为数组索引
	-	声明关联数组：`declare -A <arr>`

###	访问数组

-	`${<arr>[idx]}`：获取数组元素
	-	`$<arr>`：回直接获取数组首个元素
-	`${<arr>[@]}`：数组元素列表
	-	总是执行分词，被 `"` 括起时扩展为分词结果被括起
	-	可用于复制数组 `("${<arr>[@]}")`
-	`${<arr>[*]}`：数组元素列表
	-	被 `"` 括起时不分词，返回单个字符串，各参数值使用 `IFS` 值的首个字符分隔



